<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Proyecto Anti-Coimas — Demo</title>

  <style>
    :root{--card-bg:#fff;--accent:#007bff}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; background:#f5f7fb;margin:0;padding:20px}
    header{max-width:1000px;margin:0 auto 20px;text-align:center}
    h1{margin:.25rem 0;font-size:1.6rem}
    p.lead{color:#444;margin:0;font-size:0.95rem}
    #grid{display:flex;flex-wrap:wrap;gap:18px;justify-content:center;max-width:1100px;margin:18px auto}
    .card{background:var(--card-bg);width:260px;border-radius:12px;padding:14px;box-shadow:0 6px 18px rgba(14,30,37,0.06);display:flex;flex-direction:column;align-items:center}
    .card img.photo{width:120px;height:120px;border-radius:12px;object-fit:cover}
    .meta{width:100%;margin-top:10px}
    .meta p{margin:4px 0;font-size:0.9rem}
    .qr{margin-top:8px}
    .actions{display:flex;gap:8px;margin-top:10px;width:100%;justify-content:center}
    .btn{padding:8px 10px;border-radius:8px;border:none;cursor:pointer;font-weight:600}
    .btn.primary{background:var(--accent);color:white}
    .btn.ghost{background:#f0f2f6;color:#222}
    .comments-list{width:100%;margin-top:10px;max-height:200px;overflow:auto;border-top:1px solid #eee;padding-top:10px}
    .comment{background:#fbfbfd;border-radius:8px;padding:8px;margin-bottom:8px;border:1px solid #eee}
    .comment time{display:block;color:#666;font-size:0.78rem;margin-top:6px}
    /* modal */
    #modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.45);z-index:999}
    #modal .box{width:95%;max-width:520px;background:white;border-radius:12px;padding:16px;box-shadow:0 12px 30px rgba(2,6,23,0.2)}
    label{font-weight:600;font-size:0.9rem}
    textarea{width:100%;min-height:100px;margin-top:8px;border-radius:8px;padding:8px;border:1px solid #ddd}
    input[type="file"]{margin-top:10px}
    .note{font-size:0.85rem;color:#555;margin-top:8px}
    @media (max-width:600px){.card{width:92%}}

    /* ---- ADICIONES: nav + sección "nosotros" ---- */
    nav.main-nav{
      background:var(--accent);
      color:#fff;
      padding:10px 16px;
      border-radius:8px;
      max-width:1100px;
      margin: 0 auto 18px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      box-shadow:0 6px 18px rgba(14,30,37,0.04);
    }
    nav.main-nav .brand{font-weight:700}
    nav.main-nav .links a{color:#fff;text-decoration:none;margin-left:14px;font-weight:600}
    nav.main-nav .links a:hover{text-decoration:underline;opacity:0.95}

    section#nosotros{
      max-width:1100px;
      margin:18px auto;
      padding:18px;
      background:var(--card-bg);
      border-radius:12px;
      box-shadow:0 6px 18px rgba(14,30,37,0.06);
      text-align:center;
    }
    section#nosotros h2{margin-top:0;color:var(--accent)}
    /* ---- fin adiciones ---- */
  </style>
</head>
<body>

  <!-- ENCABEZADO / NAVEGACIÓN (no fijo) -->
  <nav class="main-nav" aria-label="Navegación principal">
    <div class="brand">Proyecto Anti-Coimas</div>
    <div class="links">
      <a href="#grid">Inicio</a>
      <a href="#nosotros">Nosotros</a>
    </div>
  </nav>

  <header>
    <h1>Proyecto Anti-Coimas — Demo</h1>
    <p class="lead">Escanea el QR de la persona para abrir la ventana de reporte. Comentario y evidencia son <strong>obligatorios</strong>.</p>
  </header>

  <main id="grid" aria-live="polite"></main>

  <!-- SECCIÓN NOSOTROS (añadida) -->
  <section id="nosotros" aria-labelledby="nosotros-title">
    <h2 id="nosotros-title">Nosotros</h2>
    <p>Somos un equipo multidisciplinario comprometido con la transparencia y la innovación social. Nacimos con la convicción de que las prácticas deshonestas como el cobro de coimas afectan directamente el desarrollo, la confianza ciudadana y la igualdad de oportunidades. Por eso, hemos diseñado una solución que busca identificar, reducir y prevenir estas conductas mediante el uso de herramientas tecnológicas accesibles y procesos claros, enfocados en proteger tanto a las instituciones como a los ciudadanos. Nuestro objetivo es transformar la manera en que se percibe la integridad, demostrando que sí es posible construir entornos más justos y confiables.</p>
    <p>Creemos que el cambio comienza desde lo cotidiano, por eso nuestro trabajo no se limita a la detección de irregularidades, sino que también promueve la educación, la conciencia y la responsabilidad colectiva. Aspiramos a que nuestra propuesta sirva como un punto de partida para un sistema más transparente, donde cada persona se sienta respaldada y respetada. En cada paso, nuestro equipo mantiene un compromiso firme con la ética y la mejora continua, porque entendemos que luchar contra el cobro de coimas no es solo un desafío técnico, sino también un compromiso humano y social.</p>
  </section>

  <!-- Modal (se usa para comentar) -->
  <div id="modal" role="dialog" aria-modal="true">
    <div class="box">
      <h2 id="modal-title">Reportar</h2>

      <form id="modal-form">
        <div style="display:flex;gap:12px;align-items:center">
          <img id="modal-photo" src="" alt="" style="width:88px;height:88px;border-radius:8px;object-fit:cover">
          <div>
            <div id="modal-name" style="font-weight:700"></div>
            <div id="modal-meta" style="color:#555;font-size:0.9rem;margin-top:6px"></div>
          </div>
        </div>

        <label for="modal-comment" style="margin-top:10px;display:block">Comentario (obligatorio)</label>
        <textarea id="modal-comment" required placeholder="Describe lo que pasó..."></textarea>

        <label style="margin-top:8px;display:block">Evidencia (obligatorio: imagen / audio / PDF)</label>
        <input id="modal-file" type="file" accept="image/*,audio/*,.pdf" required>

        <div class="note">Aviso: para esta demo la evidencia se guarda en tu navegador (localStorage) como Data URL. No es un almacenamiento en servidor.</div>

        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
          <button type="button" class="btn ghost" onclick="closeModal()">Cancelar</button>
          <button type="submit" class="btn primary">Enviar reporte</button>
        </div>
      </form>
    </div>
  </div>

  <!-- cdn QR generator (estable) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>

  <script>
  (function(){
    // ---------- CONFIG ----------
    const SITE_BASE = "https://proyectoanticoimas.netlify.app"; // <-- ya configurado con tu Netlify
    // Personas: incluye los 3 tuyos (Favio, Henry, Adriano) ya solicitados y el resto.
    const people = [
      { name: "Favio Paiva", sexo: "Masculino", rango: "Suboficial", edad: 36, photo: "https://randomuser.me/api/portraits/men/11.jpg" },
      { name: "Henry Perez", sexo: "Masculino", rango: "Teniente", edad: 42, photo: "https://randomuser.me/api/portraits/men/18.jpg" },
      { name: "Adriano Jimenez", sexo: "Masculino", rango: "Capitán", edad: 39, photo: "https://randomuser.me/api/portraits/men/19.jpg" },
      { name: "José Martinez", sexo: "Masculino", rango: "Coronel", edad: 50, photo: "https://randomuser.me/api/portraits/men/20.jpg" },
      { name: "Luis Herrera", sexo: "Masculino", rango: "Sargento", edad: 34, photo: "https://randomuser.me/api/portraits/men/21.jpg" },
      { name: "Carlos Ramirez", sexo: "Masculino", rango: "Mayor", edad: 45, photo: "https://randomuser.me/api/portraits/men/22.jpg" },
      { name: "Miguel Torres", sexo: "Masculino", rango: "Subteniente", edad: 29, photo: "https://randomuser.me/api/portraits/men/23.jpg" },
      { name: "Andrés Silva", sexo: "Masculino", rango: "Comandante", edad: 47, photo: "https://randomuser.me/api/portraits/men/24.jpg" },
      { name: "Ricardo López", sexo: "Masculino", rango: "General", edad: 55, photo: "https://randomuser.me/api/portraits/men/25.jpg" },
      { name: "Jorge Castro", sexo: "Masculino", rango: "Suboficial", edad: 32, photo: "https://randomuser.me/api/portraits/men/26.jpg" }
    ];

    // ---------- helpers ----------
    // create a safe id (ascii, kebab) from a name
    function safeId(str){
      if(!str) return "";
      // normalize accents -> remove diacritics
      const s = str.normalize("NFKD").replace(/[\u0300-\u036f]/g, "");
      return s.toLowerCase().replace(/[^a-z0-9]+/g, "-").replace(/(^-|-$)/g,"");
    }

    function storageKey(personId){ return "pa_comments_" + personId; }

    function readComments(personId){
      try {
        const raw = localStorage.getItem(storageKey(personId));
        return raw ? JSON.parse(raw) : [];
      } catch(e){ return []; }
    }

    function saveComments(personId, arr){
      try {
        localStorage.setItem(storageKey(personId), JSON.stringify(arr));
      } catch(e){
        alert("Error guardando en el navegador (posible límite de espacio).");
        console.error(e);
      }
    }

    // convert file -> dataURL (Promise)
    function fileToDataURL(file){
      return new Promise((resolve,reject)=>{
        const r = new FileReader();
        r.onload = ()=> resolve(r.result);
        r.onerror = (e)=> reject(e);
        r.readAsDataURL(file);
      });
    }

    // ---------- render grid ----------
    const grid = document.getElementById("grid");

    // build cards
    people.forEach(p => {
      const id = safeId(p.name);
      p.id = id;

      const card = document.createElement("article");
      card.className = "card";
      card.id = "card-" + id;

      // image
      const img = document.createElement("img");
      img.className = "photo";
      img.src = p.photo;
      img.alt = "Foto de " + p.name;
      card.appendChild(img);

      // name
      const h = document.createElement("h3");
      h.textContent = p.name;
      h.style.marginTop = "10px";
      card.appendChild(h);

      // meta
      const meta = document.createElement("div");
      meta.className = "meta";
      meta.innerHTML = `<p><strong>Sexo:</strong> ${p.sexo}</p>
                        <p><strong>Rango:</strong> ${p.rango}</p>
                        <p><strong>Edad:</strong> ${p.edad} años</p>`;
      card.appendChild(meta);

      // QR container
      const qrDiv = document.createElement("div");
      qrDiv.className = "qr";
      qrDiv.id = "qr-" + id;
      card.appendChild(qrDiv);

      // actions
      const actions = document.createElement("div");
      actions.className = "actions";
      const btnComment = document.createElement("button");
      btnComment.className = "btn primary";
      btnComment.type = "button";
      btnComment.textContent = "Comentar";
      btnComment.onclick = ()=> openModal(id);

      const btnShow = document.createElement("button");
      btnShow.className = "btn ghost";
      btnShow.type = "button";
      btnShow.textContent = "Ver comentarios";
      btnShow.onclick = ()=> {
        const commentsBox = document.getElementById("comments-" + id);
        commentsBox.scrollIntoView({behavior:"smooth",block:"nearest"});
        // toggle?
        commentsBox.style.display = commentsBox.style.display === "none" ? "block": "block";
      };

      actions.appendChild(btnComment);
      actions.appendChild(btnShow);
      card.appendChild(actions);

      // comments area
      const commentsArea = document.createElement("div");
      commentsArea.className = "comments-list";
      commentsArea.id = "comments-" + id;
      card.appendChild(commentsArea);

      grid.appendChild(card);

      // generate QR: ?persona=id#comentarios
      const targetURL = SITE_BASE + "?persona=" + encodeURIComponent(id) + "#comentarios";
      try {
        const qr = qrcode(0, 'M');
        qr.addData(targetURL);
        qr.make();
        // createImgTag(scale) returns an <img> string
        qrDiv.innerHTML = qr.createImgTag(4);
      } catch(e){
        // fallback: show plain link
        qrDiv.innerHTML = `<a href="${targetURL}" target="_blank">${targetURL}</a>`;
      }

      // render any existing comments
      renderCommentsList(id);
    });

    // ---------- modal handling ----------
    const modal = document.getElementById("modal");
    const modalName = document.getElementById("modal-name");
    const modalMeta = document.getElementById("modal-meta");
    const modalPhoto = document.getElementById("modal-photo");
    const modalTitle = document.getElementById("modal-title");
    const modalForm = document.getElementById("modal-form");
    const modalComment = document.getElementById("modal-comment");
    const modalFile = document.getElementById("modal-file");

    let activePersonId = null;

    function openModal(personId){
      activePersonId = personId;
      const person = people.find(x=>x.id===personId);
      if(!person) return;
      modalName.textContent = person.name;
      modalMeta.textContent = `${person.rango} · ${person.sexo} · ${person.edad} años`;
      modalPhoto.src = person.photo;
      modalTitle.textContent = `Reportar — ${person.name}`;
      modalComment.value = "";
      modalFile.value = "";
      modal.style.display = "flex";
      modalComment.focus();
    }

    function closeModal(){
      modal.style.display = "none";
      activePersonId = null;
    }

    // close modal on backdrop click
    modal.addEventListener("click", (e)=> {
      if(e.target === modal) closeModal();
    });

    // ---------- save comment ----------
    modalForm.addEventListener("submit", async function(e){
      e.preventDefault();
      if(!activePersonId) return alert("Persona no seleccionada.");

      const txt = modalComment.value.trim();
      const file = modalFile.files[0];

      if(!txt){
        alert("Debes escribir un comentario.");
        return;
      }
      if(!file){
        alert("Debes subir evidencia (imagen, audio o PDF).");
        return;
      }

      // Convert file to DataURL (base64) to persist in localStorage for demo
      let dataURL = null;
      try {
        dataURL = await fileToDataURL(file);
      } catch(err){
        console.error(err);
        alert("Error leyendo el archivo.");
        return;
      }

      // build comment object
      const commentObj = {
        text: txt,
        evidence: {
          name: file.name,
          type: file.type,
          dataURL: dataURL
        },
        createdAt: new Date().toISOString()
      };

      // save to localStorage
      const arr = readComments(activePersonId);
      arr.unshift(commentObj);
      saveComments(activePersonId, arr);

      // update UI: render comments list for this person
      renderCommentsList(activePersonId);

      // done
      closeModal();
      alert("Reporte guardado en tu navegador (demo).");
    });

    // ---------- render comments for a person ----------
    function renderCommentsList(personId){
      const box = document.getElementById("comments-" + personId);
      box.innerHTML = "";
      const arr = readComments(personId);
      if(!arr.length){
        box.innerHTML = "<div style='color:#777'>Sin comentarios aún.</div>";
        return;
      }
      arr.forEach(c=>{
        const node = document.createElement("div");
        node.className = "comment";

        // text
        const p = document.createElement("div");
        p.innerHTML = `<strong>Comentario:</strong> ${escapeHtml(c.text)}`;
        node.appendChild(p);

        // evidence preview
        if(c.evidence && c.evidence.dataURL){
          const ev = document.createElement("div");
          ev.className = "evidence";
          ev.style.marginTop = "8px";

          if(c.evidence.type.startsWith("image/")){
            const im = document.createElement("img");
            im.src = c.evidence.dataURL;
            im.style.maxWidth = "180px";
            im.style.borderRadius = "8px";
            ev.appendChild(im);
          } else if(c.evidence.type.startsWith("audio/")){
            const au = document.createElement("audio");
            au.controls = true;
            au.src = c.evidence.dataURL;
            ev.appendChild(au);
          } else if(c.evidence.type === "application/pdf" || c.evidence.name.toLowerCase().endsWith(".pdf")){
            const a = document.createElement("a");
            a.href = c.evidence.dataURL;
            a.textContent = "Ver PDF";
            a.target = "_blank";
            ev.appendChild(a);
          } else {
            const a = document.createElement("a");
            a.href = c.evidence.dataURL;
            a.textContent = "Abrir evidencia";
            a.target = "_blank";
            ev.appendChild(a);
          }

          node.appendChild(ev);
        }

        // time
        const t = document.createElement("time");
        t.textContent = (new Date(c.createdAt)).toLocaleString();
        node.appendChild(t);

        box.appendChild(node);
      });
    }

    // ---------- auto-open when ?persona=xxxx ----------
    function autoOpenFromURL(){
      try {
        const params = new URLSearchParams(window.location.search);
        const p = params.get("persona");
        if(p){
          // p is the safeId we generated in QR
          const target = people.find(x => x.id === p);
          if(target){
            // scroll into view and open modal
            const el = document.getElementById("card-" + p);
            if(el) el.scrollIntoView({behavior:"smooth",block:"center"});
            // small delay to allow scroll, then open modal
            setTimeout(()=> openModal(p), 400);
          }
        } else if(location.hash && location.hash.startsWith("#comentarios-")){
          // handle #comentarios-NameEncoded if used
          const decode = decodeURIComponent(location.hash.replace("#comentarios-",""));
          // find by name or id
          const found = people.find(x => x.id === safeId(decode) || x.name === decode);
          if(found){
            setTimeout(()=> {
              const el = document.getElementById("card-" + found.id);
              if(el) el.scrollIntoView({behavior:"smooth",block:"center"});
              openModal(found.id);
            }, 400);
          }
        }
      } catch(e){
        console.warn("No se pudo abrir automáticamente desde URL", e);
      }
    }

    // small helper to escape text shown in HTML
    function escapeHtml(text){
      return String(text).replace(/[&<>"']/g, (m)=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }

    // on load, check URL params
    window.addEventListener("load", ()=> {
      autoOpenFromURL();
    });

  })();
  </script>
</body>
</html>


